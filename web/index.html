<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CRISIS38 · Centre opérationnel Isère</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="bg-glow bg-glow-a"></div>
  <div class="bg-glow bg-glow-b"></div>

  <main>
    <section id="login-view" class="auth-wrap">
      <form id="login-form" class="panel auth-card" method="post" action="#" autocomplete="off">
        <p class="tag">Protection Civile · Isère</p>
        <h1>CRISIS38</h1>
        <p class="lead">Plateforme de pilotage des opérations de crise départementales, pensée pour une prise de décision rapide.</p>
        <label>Identifiant<input name="username" required /></label>
        <label>Mot de passe<input name="password" type="password" required /></label>
        <button type="submit">Connexion sécurisée</button>
        <p id="login-error" class="error"></p>
      </form>

      <form id="password-form" class="panel auth-card hidden" hidden method="post" action="#" autocomplete="off">
        <h2>Changement de mot de passe</h2>
        <p class="lead">Le mot de passe temporaire doit être remplacé.</p>
        <label>Nouveau mot de passe<input name="new_password" type="password" minlength="8" required /></label>
        <button type="submit">Valider</button>
        <p id="password-error" class="error"></p>
      </form>
    </section>

    <section id="app-view" class="app hidden" hidden>
      <aside class="panel sidebar">
        <div class="sidebar-header">
          <p class="tag">Centre de commandement</p>
          <h2>Isère · 38</h2>
          <p class="muted">Rôle: <strong id="current-role">-</strong></p>
          <p class="muted">Commune: <strong id="current-commune">Toutes</strong></p>
        </div>
        <nav>
          <button class="menu-btn active" data-target="situation-panel">Situation</button>
          <button class="menu-btn" data-target="services-panel">Interconnexions</button>
          <button class="menu-btn" data-target="municipalities-panel">Communes</button>
          <button class="menu-btn" data-target="logs-panel">Main courante</button>
          <button class="menu-btn" data-target="map-panel">Carte Isère</button>
          <button class="menu-btn" data-target="users-panel">Utilisateurs</button>
        </nav>
        <button id="logout-btn" class="danger">Déconnexion</button>
      </aside>

      <section class="content">
        <header class="panel hero">
          <div>
            <p class="tag">Tableau de bord en temps réel</p>
            <h1>Gestion intégrée des opérations de crise</h1>
            <p class="muted">Surveillance météo, crues, communes et coordination inter-services pour l'Isère.</p>
          </div>
          <p id="dashboard-error" class="error"></p>
        </header>

        <section id="situation-panel" class="panel view">
          <div class="kpis">
            <article class="tile"><h3>Vigilance météo</h3><p id="vigilance">-</p></article>
            <article class="tile"><h3>Niveau crues</h3><p id="crues">-</p></article>
            <article class="tile"><h3>Risque global</h3><p id="risk">-</p></article>
            <article class="tile"><h3>Communes en crise</h3><p id="crisis">0</p></article>
          </div>
          <article>
            <h3>Derniers évènements</h3>
            <ul id="latest-logs" class="list"></ul>
          </article>
        </section>

        <section id="services-panel" class="panel view hidden" hidden>
          <h3>Écosystème de données et services connectés (Isère)</h3>
          <div class="services-grid">
            <article class="service-card"><h4>Météo-France Vigilance</h4><p id="meteo-status">-</p><p id="meteo-info" class="muted"></p></article>
            <article class="service-card"><h4>Vigicrues</h4><p id="vigicrues-status">-</p><p id="vigicrues-info" class="muted"></p></article>
            <article class="service-card"><h4>Préfecture de l'Isère</h4><p>Coordination institutionnelle</p><a href="https://www.isere.gouv.fr" target="_blank" rel="noreferrer">isère.gouv.fr</a></article>
            <article class="service-card"><h4>Vigicrues Flash / inondation</h4><p>Veille complémentaire pluie-inondation</p><a href="https://www.vigicrues.gouv.fr" target="_blank" rel="noreferrer">vigicrues.gouv.fr</a></article>
            <article class="service-card"><h4>GEORISQUES</h4><p>Connaissance des aléas locaux</p><a href="https://www.georisques.gouv.fr" target="_blank" rel="noreferrer">georisques.gouv.fr</a></article>
            <article class="service-card"><h4>Info route Isère</h4><p>Axes coupés et circulation</p><a href="https://www.itinisere.fr" target="_blank" rel="noreferrer">itinisere.fr</a></article>
          </div>
          <h4>Stations Vigicrues prioritaires</h4>
          <ul id="stations-list" class="list"></ul>
        </section>

        <section id="municipalities-panel" class="panel view hidden" hidden>
          <h3>Communes & fiches pratiques</h3>
          <form id="municipality-form" class="form" data-requires-edit>
            <input name="name" placeholder="Nom commune" required />
            <input name="manager" placeholder="Responsable" required />
            <input name="phone" placeholder="Téléphone" required />
            <input name="email" placeholder="Email" type="email" required />
            <button type="submit">Ajouter</button>
          </form>
          <ul id="municipalities-list" class="list"></ul>
        </section>

        <section id="logs-panel" class="panel view hidden" hidden>
          <h3>Main courante</h3>
          <form id="log-form" class="form" data-requires-edit>
            <input name="event_type" placeholder="Type d'évènement" required />
            <input name="description" placeholder="Description opérationnelle" required />
            <button type="submit">Ajouter</button>
          </form>
          <ul id="logs-list" class="list"></ul>
        </section>

        <section id="map-panel" class="panel view hidden" hidden>
          <h3>Carte stratégique Isère</h3>
          <div class="map-layout">
            <svg class="isere-map" viewBox="0 0 420 520" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Carte stylisée Isère">
              <path id="isere-shape" d="M143 33l46 26 48-8 29 36 45 17-1 48 36 43-15 56-41 35-2 53-45 31-31 52-56 25-48-31-54-4-32-34 3-44-34-40 11-58 40-32 6-51 35-29 10-47z"/>
              <path class="river" d="M116 112c58 11 76 29 103 65 23 31 42 70 88 104"/>
              <path class="river" d="M205 76c-18 58-30 123-26 188"/>
              <circle id="grenoble-dot" cx="214" cy="230" r="7"/>
              <text x="225" y="233">Grenoble</text>
              <circle cx="127" cy="180" r="5" class="city"/><text x="137" y="183">Voiron</text>
              <circle cx="244" cy="298" r="5" class="city"/><text x="254" y="301">Vizille</text>
              <circle cx="178" cy="340" r="5" class="city"/><text x="188" y="343">La Mure</text>
            </svg>
            <div>
              <p>Niveau météo: <strong id="meteo-level">-</strong></p>
              <p>Niveau hydrologique: <strong id="river-level">-</strong></p>
              <h4>Infos pratiques</h4>
              <ul class="list practical">
                <li>CODIS 38: 18 / 112</li>
                <li>Préfecture (standard): 04 76 60 34 00</li>
                <li>SAMU: 15</li>
                <li>Portail ORSEC: référentiel départemental interne</li>
              </ul>
            </div>
          </div>
        </section>

        <section id="users-panel" class="panel view hidden" hidden>
          <h3>Comptes utilisateurs</h3>
          <p id="user-error" class="error"></p>
          <table class="users-table">
            <thead><tr><th>Utilisateur</th><th>Rôle</th><th>Commune</th><th>Créé le</th><th>Statut</th></tr></thead>
            <tbody id="users-table"></tbody>
          </table>
        </section>
      </section>
    </section>
  </main>
  <script src="/script.js"></script>
</body>
</html>
